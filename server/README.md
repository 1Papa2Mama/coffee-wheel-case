# Vector Coffee

Демо-кейс для кофейни «Vector Coffee» с колесом скидок, системой купонов и простой админкой.

## Как работает механика
- Пользователь получает `client_id` в `localStorage`.
- При первом заходе фронтенд отправляет `client_id` на `/api/identify`, сервер создаёт пользователя и выдаёт cookie сессии.
- Колесо скидок вращается только после серверного расчёта: сервер выбирает процент скидки по весам, генерирует уникальный код купона и сохраняет всё в SQLite.
- Повторный спин доступен раз в 7 дней по серверному времени.

> Важно: если очистить `localStorage`, можно получить новый `client_id`. Это демо-ограничение, но сервер всё равно контролирует cooldown по `user_id`.

## Команды
```bash
npm install
npm run dev
```

Для продакшена:
```bash
npm start
```

## ENV переменные
Создайте `.env` (опционально):
- `PORT` — порт сервера (по умолчанию 3000).
- `DB_PATH` — путь к SQLite (по умолчанию `./vector-coffee.sqlite`).
- `ADMIN_PASSWORD` — пароль админки.
- `SESSION_SECRET` — секрет для подписи cookie.

## Админка
- Откройте `/admin` и войдите по `ADMIN_PASSWORD`.
- В админке доступен список купонов, поиск по коду и отметка «использован».
- Проверка кода купона доступна через виджет «Проверка кода».

## Проверка купонов кассиром
1. Откройте `/admin`.
2. Введите код купона в блоке «Проверка кода».
3. Система покажет статус: валиден/использован/истёк.

## Деплой на Render
1. Создайте новый Web Service.
2. В качестве Root Directory укажите `server`.
3. Build Command: `npm install`.
4. Start Command: `npm start`.
5. Добавьте переменные окружения `DB_PATH`, `ADMIN_PASSWORD`, `SESSION_SECRET`.
6. Render создаст постоянный диск для SQLite (например `/var/data/vector-coffee.sqlite`).
